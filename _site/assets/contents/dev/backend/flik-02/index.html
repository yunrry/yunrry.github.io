<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>FLIK: 여행코스 추천 서비스 개발기 (백엔드 2편) - Second Brain</title>
<meta name="description" content="2026년 목표: 개발로 월급받기추가 정보 없음">


  <meta name="author" content="yunYoung e">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Second Brain">
<meta property="og:title" content="FLIK: 여행코스 추천 서비스 개발기 (백엔드 2편)">
<meta property="og:url" content="http://localhost:4000/assets/contents/dev/backend/flik-02/">


  <meta property="og:description" content="2026년 목표: 개발로 월급받기추가 정보 없음">












<link rel="canonical" href="http://localhost:4000/assets/contents/dev/backend/flik-02/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "yunYoung e",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Second Brain Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>


  
    <script src="/assets/js/custom.js"></script>
  


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--default">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Second Brain
          <span class="site-subtitle">뇌정리노트</span>
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      <h1 id="flik-여행코스-추천-서비스-개발기-백엔드-2편">FLIK: 여행코스 추천 서비스 개발기 (백엔드 2편)</h1>
<p><strong>Raspberry Pi 위에서 돌아가는 카드 스와이프 &amp; 여행코스 추천 서비스 – 도메인 설계와 배포 자동화</strong></p>

<hr />

<h2 id="-배포-자동화">⚙ 배포 자동화</h2>

<p>Raspberry Pi 환경에서 안정적인 배포를 위해 <strong>CI/CD + Docker + Nginx</strong>를 활용했다.</p>

<h3 id="1-cicd-github-actions">1. CI/CD (GitHub Actions)</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">push</code> → 자동 빌드, 테스트, Docker 이미지 생성</li>
  <li><code class="language-plaintext highlighter-rouge">main</code> 브랜치 → Blue/Green 배포 트리거</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#root/.github/workflows/deploy.yml 샘플</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">FLIK CI/CD</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">]</span>
<span class="na">env</span><span class="pi">:</span>
  <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">ghcr.io</span>
  <span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">$</span>
  <span class="na">RASPBERRY_PI_HOST</span><span class="pi">:</span> <span class="s">$</span>
  <span class="na">RASPBERRY_PI_USER</span><span class="pi">:</span> <span class="s">$</span>
  <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s">$</span>
  <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">$</span>
  <span class="c1">#--생략--</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up JDK</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-java@v3</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">java-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">21'</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cache Gradle packages</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/cache@v4</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test Flik Server</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">chmod +x gradlew</span>
          <span class="s">./gradlew clean test -Dspring.profiles.active=test --parallel --max-workers=4</span>
  <span class="na">build-and-deploy</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">test</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">github.ref == 'refs/heads/main'</span>
      <span class="s">- name</span><span class="err">:</span> <span class="s">Build with Gradle</span>
        <span class="s">run</span><span class="err">:</span> <span class="s">./gradlew clean build</span>
      <span class="s">- name</span><span class="err">:</span> <span class="s">Build Docker image</span>
        <span class="s">run</span><span class="err">:</span> <span class="s">docker build -t flik:latest .</span>
      <span class="s">- name</span><span class="err">:</span> <span class="s">Push Docker image</span>
        <span class="s">run</span><span class="err">:</span> <span class="s">docker tag flik:latest myregistry/flik:latest &amp;&amp; docker push myregistry/flik:latest</span>
</code></pre></div></div>

<hr />

<h3 id="2-bluegreen-배포">2. Blue/Green 배포</h3>

<ul>
  <li>Nginx를 <strong>로드밸런서</strong>로 설정</li>
  <li>Blue/Green upstream proxy로 <strong>무중단 배포</strong> 구현</li>
  <li>새 이미지를 배포 후 <strong>Health Check → Traffic Switch</strong></li>
</ul>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">upstream</span> <span class="s">flik-app</span> <span class="p">{</span>
   	 <span class="kn">server</span> <span class="nf">flik-blue</span><span class="p">:</span><span class="mi">8080</span> <span class="s">max_fails=3</span> <span class="s">fail_timeout=30s</span><span class="p">;</span>
    	 <span class="c1"># server flik-green:8080 max_fails=3 fail_timeout=30s;</span>
      <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>Health Check 후 트래픽 전환 (주석 스위치)</li>
  <li>문제 발생 시 이전 버전으로 <strong>빠른 롤백 가능</strong></li>
</ul>

<hr />

<h3 id="3-ssl--cdn">3. SSL / CDN</h3>

<ul>
  <li>Cloudflare를 이용한 <strong>도메인 등록 + SSL 인증서 적용</strong></li>
  <li>외부 API 연동 및 클라이언트 요청 시 HTTPS 통신 보장</li>
</ul>

<hr />

<h2 id="-테스트-전략">🧪 테스트 전략</h2>
<p>서비스코드를 작성한 후 테스트코드를 작성하는 것은 내키지 않는다.<br />
테스트하면 코드가 다 꺠질것 같은 두려움 떄문일까. 이미 구현이 끝난 코드라고 생각하는 안일함 때문일까. <br />
어떤쪽도 맞는 심리인 것 같다. 수정하기 귀찮고 다음 테스크로 빨리 넘어가고 싶으니…</p>

<p>하지만 테스트는 필요한 과정이다. 조잡하게 코드를 짜다보면 어디서 구멍이 날지 모른다.<br />
그래서 나는 최대한 <strong>TDD</strong>를 도입하여 선 테스트코드 후 서비스코드 작성 전략을 취하고자 한다. <br />
즉 요구기능 CRUD 구현은 단위 테스트부터 작성 -&gt; 테스트가 모두 커버되도록 구현한다.</p>
<ol>
  <li>기능 요구사항 작성</li>
  <li>테스트 목표 : CRUD 정상작동 확인. 크리티컬한 예외 발생 확인. 커버리지 80%이상</li>
  <li>테스트 케이스 작성 by AI (요구사항과 목표 입력)</li>
  <li>테스트 코드 작성 -&gt; 테스트를 만족하는 서비스 구현</li>
</ol>

<ul>
  <li><strong>단위 테스트</strong>: 핵심 비즈니스 로직, 도메인 이벤트 검증 (JUnit 5 + TestContainers)</li>
  <li><strong>통합 테스트</strong>: REST API + DB + Redis 동작 확인 (MockMVC + Docker Compose)</li>
  <li><strong>성능 테스트</strong>: 병목 예상 상황 시나리오 설정 -&gt; 부하 테스트 실행 (Jmeter)</li>
</ul>

<p><strong>TDD</strong> 테스트 주도 개발(Test-Driven Development)</p>

<hr />

<h2 id="-도메인-설계">🏗 도메인 설계</h2>

<p>FLIK의 핵심 기능은 <strong>“스와이프 탐색 → 장소 카드 저장 → 코스 생성”</strong> 이다.
이를 기반으로 도메인을 설계하고, <strong>DDD 원칙</strong>을 준수했다.</p>

<h3 id="핵심-도메인">핵심 도메인</h3>

<table>
  <thead>
    <tr>
      <th>도메인</th>
      <th>역할</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Spot</strong></td>
      <td>관광지 정보 저장, 카드 스와이프 기능과 연결</td>
    </tr>
    <tr>
      <td><strong>Course</strong></td>
      <td>사용자가 선택한 Spot들을 모아 코스 생성</td>
    </tr>
    <tr>
      <td><strong>Auth</strong></td>
      <td>로그인/회원 정보 관리, OAuth2 + JWT 인증 처리</td>
    </tr>
    <tr>
      <td><strong>User</strong></td>
      <td>사용자의 선호 장소 저장, 사용자의 카테고리별 선호벡터 저장</td>
    </tr>
    <tr>
      <td><strong>Post</strong></td>
      <td>게시글(여행기, 장소후기)</td>
    </tr>
  </tbody>
</table>

<h3 id="도메인-모델-샘플-spot">도메인 모델 샘플 (<code class="language-plaintext highlighter-rouge">Spot</code>)</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Spot</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">address</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">SpotType</span> <span class="n">type</span><span class="o">;</span>
    
    <span class="c1">// 생성자</span>
    <span class="kd">public</span> <span class="nf">Spot</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">address</span><span class="o">,</span> <span class="nc">SpotType</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 행동 메서드</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateInfo</span><span class="o">(</span><span class="nc">String</span> <span class="n">newName</span><span class="o">,</span> <span class="nc">String</span> <span class="n">newAddress</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">newName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">newAddress</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">@Setter</code>를 쓰지 않고 <strong>메서드 기반 업데이트</strong><br />
for <strong>불변성 유지 + 핵심 도메인 로직 내 구현</strong></li>
</ul>

<hr />

<h2 id="-api-흐름">🔄 API 흐름</h2>

<p>FLIK API는 <strong>CQRS 패턴</strong>을 적용해 읽기/쓰기 요청을 분리하기로 했다.</p>

<h3 id="예시-스팟-카드-스와이프-저장">예시: 스팟 카드 스와이프 저장</h3>
<ol>
  <li><strong>Client → Controller (in adapter/out)</strong>
<code class="language-plaintext highlighter-rouge">POST /api/spots/save</code> 요청 전달</li>
  <li><strong>Controller → UseCase</strong>
<code class="language-plaintext highlighter-rouge">SaveSpotUseCase</code> 호출</li>
  <li><strong>UseCase → Service (Core)</strong>
비즈니스 로직 실행: 사용자가 이미 좋아요 했는지 검증</li>
  <li><strong>Service → Repository (out port)</strong>
JPA Repository 또는 Redis 캐시에 저장</li>
  <li><strong>Controller → Response</strong>
<code class="language-plaintext highlighter-rouge">Response.success()</code>로 API 응답 반환</li>
</ol>

<p>이 서비스의 핵심은 사용자의 <strong>스와이프(장소 저장)이벤트</strong>이다.<br />
‘스와이프’ 동작이 곧 요청이기 때문에 즉시 응답하고 비동기로 처리하는 로직을 구상했다.<br />
따라서 장소 저장 요청은 이벤트 발행으로 이어진다.</p>

<h3 id="스팟-저장-이벤트-플로우">스팟 저장 이벤트 플로우</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Client → UseCase → EventListener → DB/Service
</code></pre></div></div>
<ol>
  <li><strong>Client</strong>
    <ul>
      <li>POST <code class="language-plaintext highlighter-rouge">/api/spots/save</code> 요청 전송</li>
    </ul>
  </li>
  <li><strong>UseCase</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">SpotSwipeEvent</code> 발행</li>
      <li>이벤트 발행 직후 API 응답: <code class="language-plaintext highlighter-rouge">Response.success()</code></li>
    </ul>
  </li>
  <li><strong>EventListener (비동기)</strong>
    <ul>
      <li>이벤트 수신 후 비동기 처리 시작</li>
      <li><code class="language-plaintext highlighter-rouge">isAlreadySaved</code> 체크</li>
      <li>DB에 저장: <code class="language-plaintext highlighter-rouge">saveUserSpot</code></li>
      <li>벡터 업데이트: <code class="language-plaintext highlighter-rouge">updateCategoryVector</code></li>
    </ul>
  </li>
  <li><strong>DB/Service</strong>
    <ul>
      <li>저장 완료 및 후처리 완료</li>
    </ul>
  </li>
</ol>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Client
   |
   v
+-----------------+
| UseCase         |
| (SpotSwipeEvent)|
+-----------------+
   |
   v
 Response.success()  &lt;-- 이벤트 발행 직후 즉시 API 응답
   |
   v
+----------------------+
| EventListener (Async)|
+----------------------+
   |
   +--&gt; check isAlreadySaved?
   |         |
   |         v
   |      already saved? ---+
   |         |               |
   |         v               |
   |     skip save           |
   |                         |
   +--&gt; saveUserSpot         |
   +--&gt; updateCategoryVector |
   |
   v
Listener 처리 완료

</code></pre></div></div>

<hr />

<h2 id="-배운-점">🔑 배운 점</h2>

<ol>
  <li>
    <p><strong>Hexagonal + DDD 설계</strong> 도메인 중심 개발<br />
 “어디까지 추상화 해야하나?” 정답은 없다. <br />
 core와 port를 순회하며 도메인 객체가 어디로부터 어디로 흘러가는지 따라가다보니 역할분리의 효과를 알 수 있었다.</p>
  </li>
  <li>
    <p><strong>Raspberry Pi + Docker 배포</strong>로 실제 서버 환경을 체험</p>
  </li>
  <li><strong>Blue/Green 배포</strong>로 무중단 서비스 구현 경험
    <ul>
      <li>blue/green 스위칭 꼬이면 컨테이너 중단하지 말고 nginx.conf를 수정하렴!</li>
      <li>추가해야할 환경변수 꼭 체크하기 -&gt; 자동화방법 찾기</li>
    </ul>
  </li>
  <li><strong>TDD + CI/CD</strong>로 테스트 자동화, 안정적 배포</li>
</ol>

<hr />

<h2 id="-마무리">💬 마무리</h2>

<p>2편에서는 FLIK의 <strong>도메인 설계, API 흐름, 배포 자동화</strong>를 중심으로 살펴봤다.
다음 편에서는 <strong>데이터처리 (수집/정제/저장)</strong> 설계와 트러블슈팅을 다룰 예정이다.</p>

<blockquote>
  <p>🔜 3편 예고: “관광지 데이터 어떻게 요리할까”</p>
</blockquote>

<hr />

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 yunYoung e. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
