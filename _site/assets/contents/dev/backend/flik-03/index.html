<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>FLIK: 여행코스 추천 서비스 개발기 - (백엔드 3편) - Second Brain</title>
<meta name="description" content="2026년 목표: 개발로 월급받기추가 정보 없음">


  <meta name="author" content="yunYoung e">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Second Brain">
<meta property="og:title" content="FLIK: 여행코스 추천 서비스 개발기 - (백엔드 3편)">
<meta property="og:url" content="http://localhost:4000/assets/contents/dev/backend/flik-03/">


  <meta property="og:description" content="2026년 목표: 개발로 월급받기추가 정보 없음">












<link rel="canonical" href="http://localhost:4000/assets/contents/dev/backend/flik-03/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "yunYoung e",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Second Brain Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>


  
    <script src="/assets/js/custom.js"></script>
  


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--default">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Second Brain
          <span class="site-subtitle">뇌정리노트</span>
        </a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      <h1 id="flik-여행코스-추천-서비스-개발기---백엔드-3편">FLIK: 여행코스 추천 서비스 개발기 - (백엔드 3편)</h1>

<h1 id="관광지-데이터-어떻게-요리할까-">관광지 데이터, 어떻게 요리할까 🍳</h1>

<blockquote>
  <p><strong>데이터 수집 → 정제 → 저장</strong>까지의 설계와 시행착오</p>
</blockquote>

<hr />

<h2 id="-공모전-조건-tourapi-필수-사용">🏁 공모전 조건: TourAPI 필수 사용</h2>

<p>FLIK은 “2025 관광데이터 공모전” 참가 조건에 따라<br />
<strong>한국관광공사 TourAPI (공공데이터포털 제공)</strong> 를 반드시 활용해야 했다.<br />
그래서 개발 초기엔 다음 순서로 데이터 수집 인프라를 준비했다.</p>

<p>1️⃣ <strong>API 키 발급</strong></p>

<ul>
  <li>공공데이터포털에서 <em>국문 관광정보 API</em> 사용 신청</li>
  <li>개발용 계정 기준 <strong>일일 1,000건 트래픽 제한</strong><br />
→ 테스트 중에는 호출 제한이 금방 걸림 (batch로 제어 필요)</li>
</ul>

<p>2️⃣ <strong>응답 구조 분석</strong></p>

<ul>
  <li>TourAPI는 XML/JSON 응답을 모두 지원하지만,<br />
구조가 깊고 key 이름이 일정하지 않아 parsing 이슈가 있었다.</li>
  <li>예: <code class="language-plaintext highlighter-rouge">addr1</code>, <code class="language-plaintext highlighter-rouge">addr2</code>, <code class="language-plaintext highlighter-rouge">cat1</code>, <code class="language-plaintext highlighter-rouge">cat2</code>, <code class="language-plaintext highlighter-rouge">cat3</code> … 같은 다단계 필드 존재<br />
→ 이후 <strong>label_depth1/2 매핑 규칙 테이블</strong>로 관리</li>
</ul>

<p>3️⃣ <strong>content_type_id 별 데이터 분리 수집</strong><br />
TourAPI는 <code class="language-plaintext highlighter-rouge">content_type_id</code>에 따라 관광지 유형이 다르다.<br />
FLIK에서는 이를 내부적으로 <strong>도메인별 테이블</strong>에 매핑했다.</p>

<table>
  <thead>
    <tr>
      <th>content_type_id</th>
      <th>수집 데이터</th>
      <th>내부 저장 테이블</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>12</td>
      <td>관광지</td>
      <td><code class="language-plaintext highlighter-rouge">fetched_tourist_attractions</code></td>
    </tr>
    <tr>
      <td>14</td>
      <td>문화시설</td>
      <td><code class="language-plaintext highlighter-rouge">fetched_cultural_facilities</code></td>
    </tr>
    <tr>
      <td>15</td>
      <td>축제/공연/행사</td>
      <td><code class="language-plaintext highlighter-rouge">fetched_festivals_events</code></td>
    </tr>
    <tr>
      <td>28</td>
      <td>레포츠</td>
      <td><code class="language-plaintext highlighter-rouge">fetched_sports_recreation</code></td>
    </tr>
    <tr>
      <td>32</td>
      <td>숙박</td>
      <td><code class="language-plaintext highlighter-rouge">fetched_accommodations</code></td>
    </tr>
    <tr>
      <td>38</td>
      <td>쇼핑</td>
      <td><code class="language-plaintext highlighter-rouge">fetched_shopping</code></td>
    </tr>
    <tr>
      <td>39</td>
      <td>음식점</td>
      <td><code class="language-plaintext highlighter-rouge">fetched_restaurants</code></td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="️-배치-서버-설계-데이터-수집의-심장">⚙️ 배치 서버 설계: 데이터 수집의 심장</h2>

<p>초기엔 FLIK 메인 서버에서 API 호출을 직접 처리했지만,<br />
<strong>트래픽 제어와 스케줄링 효율</strong>을 위해 <strong>별도 배치 서버</strong>를 구성했다.</p>

<blockquote>
  <p>🎯 목적:
외부 API를 주기적으로 호출 → 가공 → MySQL 저장<br />
(추후 Redis 캐시 및 검색엔진 확장 고려)</p>
</blockquote>

<h3 id="구조-설계">구조 설계</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Scheduler (Spring Batch)
   ↓
TourAPIClient (RestTemplate)
   ↓
Raw Data (JSON/XML)
   ↓
DataParser (정제 로직)
   ↓
SpotEntity (도메인 매핑)
   ↓
MySQL 저장
</code></pre></div></div>

<ul>
  <li><strong>Scheduler</strong>: <code class="language-plaintext highlighter-rouge">@Scheduled(cron="0 0 1 * * ?")</code>
→ 매일 새벽 1시에 수집 시작</li>
  <li><strong>TourAPIClient</strong>: <code class="language-plaintext highlighter-rouge">RestTemplate</code> 기반 외부 호출
→ content_type_id별로 endpoint 반복 호출</li>
  <li><strong>Parser</strong>: 공공데이터 필드 불일치 처리
→ 누락 필드 보정, <code class="language-plaintext highlighter-rouge">label_depth</code> 매핑, 주소 정제</li>
  <li><strong>Repository</strong>: JPA 기반 영속화
→ <code class="language-plaintext highlighter-rouge">fetched_*</code> 임시테이블 → 정제 후 <code class="language-plaintext highlighter-rouge">spot</code> 본테이블로 마이그레이션</li>
</ul>

<hr />

<h2 id="-데이터-정제-로직">🧩 데이터 정제 로직</h2>

<p>TourAPI 응답은 단순하지 않다.
카테고리(<code class="language-plaintext highlighter-rouge">cat1</code>, <code class="language-plaintext highlighter-rouge">cat2</code>, <code class="language-plaintext highlighter-rouge">cat3</code>)와 지역정보(<code class="language-plaintext highlighter-rouge">areacode</code>, <code class="language-plaintext highlighter-rouge">sigungucode</code>)를<br />
FLIK의 자체 비즈니스 분류(<code class="language-plaintext highlighter-rouge">역사문화</code>, <code class="language-plaintext highlighter-rouge">자연</code>, <code class="language-plaintext highlighter-rouge">카페</code> 등)로 <strong>매핑</strong>해야 했다.</p>

<h3 id="label_depth-매핑-예시">label_depth 매핑 예시</h3>

<table>
  <thead>
    <tr>
      <th>label_depth1</th>
      <th>label_depth2</th>
      <th>FLIK 카테고리</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>A02</td>
      <td>A0201</td>
      <td>역사문화</td>
    </tr>
    <tr>
      <td>A05</td>
      <td>A0502</td>
      <td>전통시장</td>
    </tr>
    <tr>
      <td>C01</td>
      <td>C0112</td>
      <td>카페</td>
    </tr>
    <tr>
      <td>A03</td>
      <td>A0302</td>
      <td>테마파크</td>
    </tr>
    <tr>
      <td>A01</td>
      <td>A0101</td>
      <td>자연</td>
    </tr>
    <tr>
      <td>A04</td>
      <td>A0401</td>
      <td>실내여행지</td>
    </tr>
    <tr>
      <td>A06</td>
      <td>A0601</td>
      <td>액티비티</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>📌 최종적으로 <code class="language-plaintext highlighter-rouge">spot</code> 테이블에는 <code class="language-plaintext highlighter-rouge">category</code> 컬럼이 FLIK 내부 분류로 저장됨.<br />
API 응답의 복잡한 코드 체계를 사람이 이해할 수 있는 형태로 단순화.</p>
</blockquote>

<hr />

<h2 id="️-트러블슈팅-우리가-부딪힌-문제들">⚠️ 트러블슈팅: 우리가 부딪힌 문제들</h2>

<h3 id="1️⃣-응답-필드-누락">1️⃣ 응답 필드 누락</h3>

<ul>
  <li>TourAPI 응답에서 특정 필드가 비정상적으로 null로 오는 경우 존재</li>
  <li>예: <code class="language-plaintext highlighter-rouge">cat3</code>가 없는 데이터
→ <code class="language-plaintext highlighter-rouge">Optional.ofNullable()</code> + 기본값 처리로 대응</li>
</ul>

<h3 id="2️⃣-중복-데이터-발생">2️⃣ 중복 데이터 발생</h3>

<ul>
  <li>동일한 관광지가 content_type_id가 다르게 등록된 케이스 발견<br />
→ <code class="language-plaintext highlighter-rouge">contentid</code>를 기준으로 중복 필터링</li>
</ul>

<h3 id="3️⃣-api-호출-제한-1000건day">3️⃣ API 호출 제한 (1000건/day)</h3>

<ul>
  <li>테스트 중 연속 요청 시 금방 제한 도달
→ content_type_id별 호출 분리 + 딜레이(<code class="language-plaintext highlighter-rouge">Thread.sleep</code>) 적용<br />
→ 배치 실행 시 로그 기록 (<code class="language-plaintext highlighter-rouge">fetch_log</code> 테이블)</li>
</ul>

<h3 id="4️⃣-인코딩-문제">4️⃣ 인코딩 문제</h3>

<ul>
  <li>응답에 특수문자, HTML entity가 섞여 있음
→ Apache Commons <code class="language-plaintext highlighter-rouge">StringEscapeUtils.unescapeHtml4()</code> 사용</li>
</ul>

<hr />

<h2 id="-결과-정제된-관광-데이터베이스">💾 결과: 정제된 관광 데이터베이스</h2>

<p>최종적으로 다음과 같은 형태로 정제 데이터가 저장된다.</p>

<table>
  <thead>
    <tr>
      <th>컬럼</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>id</td>
      <td>PK</td>
    </tr>
    <tr>
      <td>title</td>
      <td>장소명</td>
    </tr>
    <tr>
      <td>address</td>
      <td>주소</td>
    </tr>
    <tr>
      <td>category</td>
      <td>비즈니스 카테고리</td>
    </tr>
    <tr>
      <td>content_type_id</td>
      <td>원본 분류코드</td>
    </tr>
    <tr>
      <td>image_urls</td>
      <td>대표 이미지</td>
    </tr>
    <tr>
      <td>description</td>
      <td>설명</td>
    </tr>
    <tr>
      <td>phone</td>
      <td>연락처</td>
    </tr>
    <tr>
      <td>lat/lng</td>
      <td>좌표</td>
    </tr>
    <tr>
      <td>reg_date</td>
      <td>등록일</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="-다음-이야기-예고">📅 다음 이야기 예고</h2>

<p>데이터를 가져와서 저장했다면,<br />
이제 그걸 “사용자에게 어떻게 보여줄지”가 남았다.  <br />
다음 편에서는 <strong>데이터 검색 및 추천 시스템 설계</strong>를 다룬다.<br />
(사용자 스와이프 패턴 + 카테고리 벡터 기반 추천 로직)</p>

<blockquote>
  <p>🔜 4편 예고: “나에게 맞는 여행지는 무엇일까?”</p>
</blockquote>

<hr />


    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 yunYoung e. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
